<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>3-传输层 | Ywrby个人博客网站</title><meta name="keywords" content="计算机网络"><meta name="author" content="Ywrby"><meta name="copyright" content="Ywrby"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="传输层传输层概述传输层是整个TCP&#x2F;IP协议栈核心之一，位于网络层之上，应用层之下。利用网络层的服务，为上层应用层提供服务。与网络层类似，传输层也拥有面向连接的服务与无连接的服务两种，用途在于提供高效的可靠的，性价比高的数据传输 传输层的作用在于为运行在不同主机上的应用进程提供逻辑通信（这里的逻辑通信指的是在传输层角度看来两个进程间直接进行通信，实际上还是通过下层提供的服务，不都安将数据向下层传递">
<meta property="og:type" content="article">
<meta property="og:title" content="3-传输层">
<meta property="og:url" content="http://ywrby.cn/2021/03/25/3-%E4%BC%A0%E8%BE%93%E5%B1%82/index.html">
<meta property="og:site_name" content="Ywrby个人博客网站">
<meta property="og:description" content="传输层传输层概述传输层是整个TCP&#x2F;IP协议栈核心之一，位于网络层之上，应用层之下。利用网络层的服务，为上层应用层提供服务。与网络层类似，传输层也拥有面向连接的服务与无连接的服务两种，用途在于提供高效的可靠的，性价比高的数据传输 传输层的作用在于为运行在不同主机上的应用进程提供逻辑通信（这里的逻辑通信指的是在传输层角度看来两个进程间直接进行通信，实际上还是通过下层提供的服务，不都安将数据向下层传递">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg">
<meta property="article:published_time" content="2021-03-25T09:18:41.000Z">
<meta property="article:modified_time" content="2021-03-27T13:02:07.264Z">
<meta property="article:author" content="Ywrby">
<meta property="article:tag" content="计算机网络">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg"><link rel="shortcut icon" href="/img/title.png"><link rel="canonical" href="http://ywrby.cn/2021/03/25/3-%E4%BC%A0%E8%BE%93%E5%B1%82/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-9KH3pHEMgz"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-27 21:02:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/ywrby.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">70</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://space.bilibili.com/353923033"><i class="fa-fw fas fa-file-video"></i><span> Bilibili</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ywrby个人博客网站</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://space.bilibili.com/353923033"><i class="fa-fw fas fa-file-video"></i><span> Bilibili</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">3-传输层</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-03-25T09:18:41.000Z" title="Created 2021-03-25 17:18:41">2021-03-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-03-27T13:02:07.264Z" title="Updated 2021-03-27 21:02:07">2021-03-27</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h1><h2 id="传输层概述"><a href="#传输层概述" class="headerlink" title="传输层概述"></a>传输层概述</h2><p>传输层是整个TCP/IP协议栈核心之一，位于网络层之上，应用层之下。利用网络层的服务，为上层应用层提供服务。与网络层类似，传输层也拥有面向连接的服务与无连接的服务两种，<strong>用途在于提供高效的可靠的，性价比高的数据传输</strong></p>
<p>传输层的作用在于为运行在不同主机上的应用进程提供逻辑通信（这里的逻辑通信指的是在传输层角度看来两个进程间直接进行通信，实际上还是通过下层提供的服务，不都安将数据向下层传递并在对方处向上传递后才实现通信），简言之，<strong>传输层提供的是进程到进程间的通信</strong></p>
<h3 id="传输实体"><a href="#传输实体" class="headerlink" title="传输实体"></a>传输实体</h3><p>完成传输层任务的硬件或软件</p>
<ul>
<li>传输实体可以在操作系统的内核</li>
<li>可以以一个链接库的形式绑定到网络应用中</li>
<li>可以以一个独立的用户进程运行</li>
<li>甚至可以实现在网络接口卡（网卡）上</li>
</ul>
<h3 id="传输层与网络层的区别"><a href="#传输层与网络层的区别" class="headerlink" title="传输层与网络层的区别"></a>传输层与网络层的区别</h3><p>网络层运行在由承运商操作的路由器上，因此用户无法真正控制网络层。对于丢包，高延迟等问题只能选择被动接受。传输层架设在网络层之上，允许用户控制服务质量</p>
<p>传输层原语独立于网络层原语，而网络层原语会因为网络的不同而不同。传输层的原语在向应用层传输的原语可以屏蔽掉这些不同，只提供标准，统一的原语。</p>
<blockquote>
<p>原语：计算机进程的控制通常由原语完成。所谓原语，一般是指由若干条指令组成的程序段，用来实现某个特定功能，在执行过程中不可被中断。在操作系统中，某些被进程调用的操作，如队列操作、对信号量的操作、检查启动外设操作等，一旦开始执行，就不能被中断，否则就会出现操作错误，造成系统混乱。所以，这些操作都要用原语来实现 原语是操作系统核心（不是由进程，而是由一组程序模块组成）的一个组成部分，并且常驻内存，通常在管态下执行。原语一旦开始执行，就要连续执行完，不允许中断</p>
</blockquote>
<p>传输层和网络层的作用范围不同，网络层负责把数据从源机送达到目的机（主机到主机 Host to Host）。传输层负责把数据送达到具体的应用进程或端口（End to End 端到端，end point端点即套接字socket和某个具体的应用程序绑定）</p>
<h3 id="数据段TPDU"><a href="#数据段TPDU" class="headerlink" title="数据段TPDU"></a>数据段TPDU</h3><p>传输层处理的协议数据单元是TPDU(Transport Protocol Data Unit)即数据段(segment)，是从传输实体发到对应端传输实体的信息</p>
<p>TPDU作为数据（载荷）被封装在分组（packet）中，通过网络层进行传输交换</p>
<h3 id="常用协议"><a href="#常用协议" class="headerlink" title="常用协议"></a>常用协议</h3><ol>
<li>用户数据报协议（UDP：User Datagram Protocol）</li>
<li>传输控制协议（TCP：Transmission Control Protocol）</li>
</ol>
<h3 id="多路复用与解复用"><a href="#多路复用与解复用" class="headerlink" title="多路复用与解复用"></a>多路复用与解复用</h3><h4 id="多路复用"><a href="#多路复用" class="headerlink" title="多路复用"></a>多路复用</h4><p>在发送报文的主机一端完成，从多个套接字接收来自多个进程的报文，根据套接字获取对应报文的IP地址和目标端口，并将目标端口传给传输层进行报文段的封装，IP地址传给网络层进行数据报的封装。这些头部信息用于进行以后的解封装</p>
<h4 id="多路解复用"><a href="#多路解复用" class="headerlink" title="多路解复用"></a>多路解复用</h4><p>在位于接收报文一端的主机处完成，根据报文段头部信息中的端口号与数据报中提供的IP地址将接收到的报文段传送给正确的套接字</p>
<blockquote>
<p>这里比较难以理解的一点是，传输层直接与套接字相联系，而传输层上的报文段只包含了源端口与目标端口，并没有主机IP地址信息，那么IP地址是如何传送给相应套接字进行匹配的？  事实上，只需要认清TCP/IP中的各层结构是人们认为规定的标准结构，是存在于虚拟环境下的结构（至少对于传输层和网络层是如此）通过套接字编程就可以看出，无论是报文，报文段还是数据报都是通过参数向下一层逐层传递的，所以虽然IP地址在从网络层向传输层传递之前就已经被取出，其也可以通过参数的形式向传输层传递并最终传递给套接字进行套接字的匹配或更新。</p>
</blockquote>
<h4 id="无连接（UDP）多路解复用"><a href="#无连接（UDP）多路解复用" class="headerlink" title="无连接（UDP）多路解复用"></a>无连接（UDP）多路解复用</h4><p>UDP套接字用二元组标识(目标IP地址、目标端口号)，即通过目标IP地址与目标端口号可以唯一标识一个UDP Socket,这就说明源IP或源端口不同但目标IP与端口一致的两个请求会指向同一个套接字</p>
<p>无连接多路解复用的过程一般是：</p>
<ol>
<li>主机收到UDP报文段</li>
<li>检查报文段的目的端口（由于已经传送到目的主机上，所以目的端口唯一标识一个套接字）</li>
<li>存在与该端口对应的套接字则将该报文段传送给套接字</li>
<li>不存在则创建套接字并传给其报文段</li>
</ol>
<h4 id="面向连接（TCP）的多路解复用"><a href="#面向连接（TCP）的多路解复用" class="headerlink" title="面向连接（TCP）的多路解复用"></a>面向连接（TCP）的多路解复用</h4><p>TCP套接字:四元组本地标识：源IP地址，源端口号，目的IP地址，目的端口号</p>
<p>TCP套接字由四元组唯一标识，也就是说四元组中哪怕只有一个参数不相同，都会指向不同的套接字。</p>
<p>这使得刚才在UDP多路解复用中出现的不同源端由于目的相同使用同一个套接字的情况不会出现，Web服务器对每个连接客户端有不同的套接字</p>
<hr>
<h2 id="用户数据报协议-UDP"><a href="#用户数据报协议-UDP" class="headerlink" title="用户数据报协议 UDP"></a>用户数据报协议 UDP</h2><p><strong>（User Dataprogram Protocol）</strong></p>
<p>UDP是一个无连接的传输层协议,UDP传输的是数据段，无需建立连接，不提供数据的可靠传输。很多网络应用，例如DNS都采用了UDP。UDP传输的是UDP数据段</p>
<h3 id="UDP数据段"><a href="#UDP数据段" class="headerlink" title="UDP数据段"></a>UDP数据段</h3><p>数据段包括<strong>总长为64bits，共4部分，每部分16bits的数据段头</strong>和数据两个部分。</p>
<h4 id="数据段头结构"><a href="#数据段头结构" class="headerlink" title="数据段头结构"></a>数据段头结构</h4><p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/hdaushdaushd.jpg"></p>
<p>第三个字段数据段长度表示包括段头和数据的总长度，UDP中校验和可能存在也可能不存在，不存在时校验和长度设为0.</p>
<p>UDP数据段头最重要的内容就是前两个字段源端口和目的端口，二者长度均为16bits，能表示的最大长度是65536，也就是能表示的端口数量是65536个，范围从0~65535。</p>
<h4 id="端口定义"><a href="#端口定义" class="headerlink" title="端口定义"></a>端口定义</h4><table>
<thead>
<tr>
<th>端口号</th>
<th>-</th>
</tr>
</thead>
<tbody><tr>
<td>小于等于1023（知名端口）</td>
<td>用于公共应用（保留，全局分配，用于标准服务器），只能用于特权用户，比如UNIX的root用户启动标准80服务。由IANA分配，目前已经使用700多个</td>
</tr>
<tr>
<td>1024~49151</td>
<td>用户端口/非特权用户端口，可以通过IANA注册（例如BT使用了6881-6887的端口）</td>
</tr>
<tr>
<td>大于等于49152</td>
<td>动态端口，私人端口（其中包括自由端口：free port,由本地分配，并且动态随机生成的端口号，访问网站时操作系统会随机产生一个自由端口用于访问）</td>
</tr>
</tbody></table>
<h4 id="UDP校验和"><a href="#UDP校验和" class="headerlink" title="UDP校验和"></a>UDP校验和</h4><p>UDP校验和计算方式是将IP伪头部，UDP头部和数据按照二进制每行16位的格式排列，然后对这些排列好的数据进行补码相加求和，再对得到的结果进行求反码，最终得到的结果就是校验和</p>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/UDP%E6%A0%A1%E9%AA%8C%E5%92%8C.jpg" alt="UDP校验和"></p>
<h4 id="TCP-UDP伪头部（pseudo-header）"><a href="#TCP-UDP伪头部（pseudo-header）" class="headerlink" title="TCP/UDP伪头部（pseudo header）"></a>TCP/UDP伪头部（pseudo header）</h4><p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/TCP_UDP%E4%BC%AA%E5%A4%B4%E9%83%A8.jpg" alt="TCP_UDP伪头部"></p>
<p>接收方在接收到数据段后利用其中的校验和以及其他部分数据经过计算最终得到的结果每个位应该全部为1，如果出现0，证明传输过程中发生错误。</p>
<p>在计算校验和的过程中使用了属于网络层的IP地址，这破坏了分层原则</p>
<p>UDP提供端点标识，端到端的数据传输，不提供差错检测和可靠传输，但简洁高效</p>
<hr>
<h2 id="通信模型"><a href="#通信模型" class="headerlink" title="通信模型"></a>通信模型</h2><h3 id="端点"><a href="#端点" class="headerlink" title="端点"></a>端点</h3><p>端点就是所说的套接字（Socket），一个套接字包括；两个内容：IP地址和端口号。可以写成(IP,Port)。</p>
<h3 id="通信模型-通信五元组"><a href="#通信模型-通信五元组" class="headerlink" title="通信模型-通信五元组"></a>通信模型-通信五元组</h3><p>通信五元组由源端点，目的端点和协议组成，其中源端点和目的端点包含IP地址和端口，协议可以是TCP或UDP</p>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/%E9%80%9A%E4%BF%A1%E4%BA%94%E5%85%83%E7%BB%84.jpg" alt="通信五元组"></p>
<h3 id="一些已分配的知名端口"><a href="#一些已分配的知名端口" class="headerlink" title="一些已分配的知名端口"></a>一些已分配的知名端口</h3><table>
<thead>
<tr>
<th>Port</th>
<th>Protocol</th>
<th>Use</th>
</tr>
</thead>
<tbody><tr>
<td>21</td>
<td>FTP</td>
<td>File Transfer</td>
</tr>
<tr>
<td>23</td>
<td>Telnet</td>
<td>Remote login</td>
</tr>
<tr>
<td>25</td>
<td>SMTP</td>
<td>E-mail</td>
</tr>
<tr>
<td>69</td>
<td>TFTP</td>
<td>Trivial file transfer protocol</td>
</tr>
<tr>
<td>79</td>
<td>Finger</td>
<td>Looking information about a user</td>
</tr>
<tr>
<td>80</td>
<td>HTTP</td>
<td>World Wide Web</td>
</tr>
<tr>
<td>110</td>
<td>POP-3</td>
<td>Remote email access</td>
</tr>
<tr>
<td>119</td>
<td>NNTP</td>
<td>USENET news</td>
</tr>
</tbody></table>
<p>不同于交换机上的端口(Interface接口)，此端口非彼端口.</p>
<hr>
<h2 id="TCP数据段"><a href="#TCP数据段" class="headerlink" title="TCP数据段"></a>TCP数据段</h2><h3 id="TCP-传输控制协议"><a href="#TCP-传输控制协议" class="headerlink" title="TCP-传输控制协议"></a>TCP-传输控制协议</h3><p><strong>（Transmission Control Protocol）</strong></p>
<p>是专门为了<strong>在不可靠的网络上提供可靠的端到端的字节流</strong>而设计的。TCP必须动态地适应不同的拓扑、带宽、延迟、分组大小和其它的参数，并且当有错误的时候，能够足够健壮</p>
<p>支持TCP的机器都有一个TCP实体，或者是用户进程，或者是操作系统内核。都可以管理TCP流跟IP层接口</p>
<h4 id="发方：封装"><a href="#发方：封装" class="headerlink" title="发方：封装"></a>发方：封装</h4><p>TCP实体接收本地进程的用户数据流，将其分割成不超<br>过64kB的分片（实践中，通常分割成1460字节，以通过<br>以太网传输）</p>
<h4 id="收方：解封装"><a href="#收方：解封装" class="headerlink" title="收方：解封装"></a>收方：解封装</h4><p>当包含TCP数据段的报文到达某台机器的时候，被提交<br>给传输实体，传输实体将其重构出原始的字节流</p>
<ul>
<li>TCP连接上的每个字节都有它自己独有的32位序列号</li>
<li>收发双方的TCP实体以数据段的形式交换数据</li>
<li>一个数据段包括20字节的头部（不包括可选项）和数据域（0或更多字节） </li>
</ul>
<h4 id="TCP软件决定数据段的大小，有两个因素限制了数据段的长度："><a href="#TCP软件决定数据段的大小，有两个因素限制了数据段的长度：" class="headerlink" title="TCP软件决定数据段的大小，有两个因素限制了数据段的长度："></a>TCP软件决定数据段的大小，有两个因素限制了数据段的长度：</h4><ul>
<li>TCP数据段必须适合IP的65515（65535B-20B）的载荷限制(65535B是IP分组最大长度，20是IP分组头部固定长度，65515就是IP分组净载荷)</li>
<li>每个TCP数据段必须适合于下层网络的 MTU （如，1500 字节以太网载荷大小）</li>
<li>TCP使用的基本协议具有动态窗口大小的滑动窗口协议<br>（sliding window protocol）</li>
</ul>
<h3 id="TPDU-TCP数据段"><a href="#TPDU-TCP数据段" class="headerlink" title="TPDU TCP数据段"></a>TPDU TCP数据段</h3><p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/TPDU.jpg" alt="TPDU"></p>
<h4 id="源端口和目的端口字段"><a href="#源端口和目的端口字段" class="headerlink" title="源端口和目的端口字段"></a>源端口和目的端口字段</h4><p>标明了一个连接的两个端点，是通信五元组中的两个重要元素，用来跟踪同一时间内通过网络的不同会话。一般每个端口对应一个应用程序</p>
<h4 id="序列号-–-字节号-32-位"><a href="#序列号-–-字节号-32-位" class="headerlink" title="序列号 – 字节号 (32 位)"></a>序列号 – 字节号 (32 位)</h4><p>表示一个字节的编号，其中最特殊的是初始序列号ISNs(initial sequence numbers )：随机产生的</p>
<h4 id="确认号"><a href="#确认号" class="headerlink" title="确认号"></a>确认号</h4><p>期望接收的字节号 (32位)，在TCP中为了保证可靠传输，才哟过了肯定确认重传技术，确认号就是用于肯定确认重传</p>
<h4 id="TCP段头长度"><a href="#TCP段头长度" class="headerlink" title="TCP段头长度"></a>TCP段头长度</h4><p>单位32位（4字节），含义与IP的段头长度完全一致</p>
<h4 id="保留域-字段"><a href="#保留域-字段" class="headerlink" title="保留域/字段"></a>保留域/字段</h4><p>即图中灰色部分，现在也开始逐步使用（进行拥塞控制等）</p>
<h4 id="控制比特"><a href="#控制比特" class="headerlink" title="控制比特"></a>控制比特</h4><p>URG，ACK，PSH，RST，SYN，FIN共6部分，每部分1byte，称作控制比特</p>
<ul>
<li>URG：当紧急指针使用的时候，URG被置为1。紧急指针是一个对于当前序列号的字节偏移量，标明紧急数据从哪里开始<ul>
<li>当URG=1时，表明有紧急数据，必须首先处理</li>
<li>与紧急指针配合使用</li>
<li>收方收到这样的数据后，马上处理，处理完后恢复正常操作</li>
<li>即使win=0，也可以发送这样的紧急数据段</li>
</ul>
</li>
<li>ACK：1表示确认号有效，0表示确认号无效</li>
<li>PSH：表示这是带有PUSH标志的数据接收方收到这样的数据，应该立刻送到上层，而不需要缓存它</li>
<li>RST：被用来重置一个已经混乱的连接</li>
<li>SYN 用在连接建立的过程<ul>
<li>SYN=1，ACK=0：连接请求</li>
<li>SYN=1，ACK=1：连接接受</li>
</ul>
</li>
<li>FIN：被用来释放连接，它表示发送方已经没有数据要传输了，但是可以继续接收数据</li>
</ul>
<h4 id="窗口尺寸"><a href="#窗口尺寸" class="headerlink" title="窗口尺寸"></a>窗口尺寸</h4><p>为了避免收方被大量涌入数据所淹没，TCP实体进行了流控（Flow Control）。通常使用可变长的滑动窗口来完成流控。所以第十二个字段用16位来表示窗口尺寸</p>
<p>告诉对方可以发送的数据字节数（从确认字节号<br>开始（决定于接收方）</p>
<h4 id="校验和"><a href="#校验和" class="headerlink" title="校验和"></a>校验和</h4><p>与UDP中的校验和是一样的，唯一区别在于协议位置的编号不一样</p>
<h4 id="紧急指针"><a href="#紧急指针" class="headerlink" title="紧急指针"></a>紧急指针</h4><p>和URG数据段配合使用，指明了紧急数据</p>
<h4 id="选项域-可选"><a href="#选项域-可选" class="headerlink" title="选项域(可选)"></a>选项域(可选)</h4><p>提供了一种增加基本头没有包含内容的方法</p>
<hr>
<h2 id="TCP三次握手建立连接"><a href="#TCP三次握手建立连接" class="headerlink" title="TCP三次握手建立连接"></a>TCP三次握手建立连接</h2><p>TCP提供的是面向连接的服务，TCP数据段的传输是在TCP链接上进行的。而TCP连接是三次握手建立的</p>
<h3 id="TCP连接的建立"><a href="#TCP连接的建立" class="headerlink" title="TCP连接的建立"></a>TCP连接的建立</h3><ul>
<li>一方（server）被动地等待一个进来的连接请求</li>
<li>另一方（the client）通过发送连接请求，设置一些参数（第一次握手）</li>
<li>服务器方回发确认应答（第二次握手）</li>
<li>应答到达请求方，请求方最后确认，连接建立（第三次握手）</li>
</ul>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.jpg" alt="三次握手"></p>
<p>在经过三次握手后，就成功建立了TCP连接，任何采用TCP的应用在正式传输数据前都会先建立这条连接。</p>
<p>三次握手建立TCP连接也被称为同步。这个过程中双方交换的最重要参数就是初始序列号，初始序列号可以用来跟踪后续交换的每一个字节</p>
<p>建立TCP连接的双方没有主从之分，它们可以相互收发数据，也就是说TCP数据段的传输是全双工的</p>
<h3 id="DoS攻击"><a href="#DoS攻击" class="headerlink" title="DoS攻击"></a>DoS攻击</h3><p>三次握手连接可能导致一些安全问题，例如著名的：SYN泛洪导致DoS攻击</p>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/DoS.jpg" alt="DoS"></p>
<p>服务器通过大量的代理服务器，向被攻击的机器不断发送大量（泛洪）的第一次握手信息SYN，被攻击机器在收到第一次握手信息后会回发第二次握手信息，并且等待接收第三次握手信息，但是由于发送的第一次握手信息使用了伪造的IP地址，所以被攻击的机器永远无法收到第三次握手信息，这让被攻击者挂起很多进程在等待，最终因为资源耗尽而瘫痪</p>
<hr>
<h2 id="TCP连接释放"><a href="#TCP连接释放" class="headerlink" title="TCP连接释放"></a>TCP连接释放</h2><p>经过三次握手建立TCP连接之后，就可以开始进行数据的传输，在数据传输完后，就需要释放掉这条TCP连接</p>
<ul>
<li>任何一方在没有数据要传送的时候，都可以发送一个FIN置位了的 TCP 数据段</li>
<li>当FIN被确认的时候，该方向的连接被关闭</li>
<li>当双向连接都关闭了的时候，连接释放</li>
</ul>
<p>由于决定何时两边都释放这个问题具有一定难度，它极易形成两军队问题</p>
<blockquote>
<p>两军队攻击敌人，单独出击必败，两军出击必胜，如何战胜敌人？最好的方法就是相互通信决定攻击时间，但一方发出消息后无法确定对方是否成功收到消息，因此对方会发出确认消息，由此双方会不断互发确认消息，无法结束,即最后信息的发送者，永远无法知道这个信息是否到达</p>
</blockquote>
<ul>
<li>为了避免两军队（two-army）问题，使用定时器：<ul>
<li>如果一方发送了FIN数据段出去却在一个设定的时间没有收到应答，释放连接。另一方最终会注意到连接的对方已经不在了，超时后连接释放</li>
</ul>
</li>
<li>理论上讲，如果初始DR的和重传都丢了，协议失败<ul>
<li>发送者将放弃发送且释放连接，但是，另外一端却不知道这些情况，仍然处于活跃的状态，这种情形导致半开放连接（half-open）</li>
</ul>
</li>
<li>杀死半开放连接的方式<ul>
<li>如果在一定的时间内，没有TPDUs到达的话，连接自动释放</li>
<li>如果这样，传输实体在发送一个TPDU的时候必须启动定时<br>器，定时器超期，将发动一个哑TPDU（dummy TPDU），以免被断掉</li>
</ul>
</li>
</ul>
<h3 id="三次握手正常释放连接"><a href="#三次握手正常释放连接" class="headerlink" title="三次握手正常释放连接"></a>三次握手正常释放连接</h3><p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/%E6%AD%A3%E5%B8%B8%E9%87%8A%E6%94%BE.jpg" alt="正常释放"></p>
<h3 id="TCP四次挥手终止会话"><a href="#TCP四次挥手终止会话" class="headerlink" title="TCP四次挥手终止会话"></a>TCP四次挥手终止会话</h3><p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.jpg" alt="四次挥手"></p>
<h3 id="最后的确认TPDU丢失"><a href="#最后的确认TPDU丢失" class="headerlink" title="最后的确认TPDU丢失"></a>最后的确认TPDU丢失</h3><p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/%E4%B8%A2%E5%A4%B1%E9%87%8A%E6%94%BE.jpg" alt="丢失释放"></p>
<hr>
<h2 id="TCP传输策略"><a href="#TCP传输策略" class="headerlink" title="TCP传输策略"></a>TCP传输策略</h2><p>TCP传输采用了基本的肯定确认重传技术，TCP以数据段形式传输数据，一个数据段包含很多字节，相当于批量传输。为避免大量数据淹没接收方，采用流控技术。利用到了数据段当中的一个字段窗口尺寸（Window Size）。</p>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/%E4%BC%A0%E8%BE%93%E7%AD%96%E7%95%A5.jpg" alt="传输策略"></p>
<hr>
<p>可以看到整个流程中发送方首先向接收方传输了一个数据段，这个数据段大小2K，SEQ为0，表示从0开始填充字节</p>
<p>接收方大小为4K，此时接收方为空，接收方在成功接收数据段后剩余2K空余位置，然后向发送方回发确认，确认中包括了ACK=2048表示成功接收到了2048以前的字段，期望接受从2048往后的字段，以及WIN=2048表示接收方还剩余2K位空余位置，下次传输数据的大小不能超过2K</p>
<p>发送方在接收到确认后会继续发送剩余数据，可以看到，发送方在下次发送时，会根据确认调整传输数据大小以及初始序列号（SEQ）</p>
<p>在第二次传输数据完成后，接收方被占满，没有了空余位置，接收方收到确认后就会开始等待，等接收方重新获得空余位置并再次返回确认后再继续发送数据，知道所有数据全部传输完成</p>
<p>当窗口数为 0 时，发送者不能正常发送数据段，除非:</p>
<ul>
<li>Urgent数据。比如，用户想杀掉远端机器上的进程的时候，可以发送数据</li>
<li>发送者可以发送一个字节的数据段，以便让接收者再次发送期待接收的字节号和窗口数（避免死锁）</li>
</ul>
<p>发送者不需要马上发送应用程序产生的数据,接收者也不需要马上发送应答（当收到数据的时候）</p>
<p>考虑一个指向某交互式编辑器（远程）的TELNET 连接，该编辑器对用户的每次击键都作出响应，在最坏的情况下：</p>
<ul>
<li>当用户敲入一个字符的时候，被送到传输实体，创建一个21字节的数据段，在传到网络层，变成了41字节的IP分组</li>
<li>接收方（运行着编辑器的远端机）收到这个信息后，会立刻发送一个40字节的确认分组（20字节的TCP段头和20字节的IP头）</li>
<li>随后，当编辑器读取出这个字节，TCP实体发送一个窗口更新，这个分组也是40字节</li>
<li>最后，当编辑器处理了这个字符，它发送一个41字节的分组作为该字符的回显</li>
<li>总共累计起来，对于每个敲入的字符，需要至少 162 字节的带宽（还没有考虑到链路层的开销），发送4个数据段</li>
</ul>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/telnet%E6%9C%80%E5%9D%8F%E6%83%85%E5%86%B5.jpg" alt="telnet最坏情况"></p>
<h3 id="优化接收端"><a href="#优化接收端" class="headerlink" title="优化接收端"></a>优化接收端</h3><p>接收端可以推迟500ms发送确认分组和窗口更新窗口，以便可以免费搭载在处理后的回显分组内（free ride）</p>
<h3 id="优化发送端"><a href="#优化发送端" class="headerlink" title="优化发送端"></a>优化发送端</h3><h4 id="Nagle算法"><a href="#Nagle算法" class="headerlink" title="Nagle算法"></a>Nagle算法</h4><ul>
<li>当数据以一次一字节的速度到达的时候，只发送第一个字节，然后将后续的字节缓存起来，直到发出的字节得到确认</li>
<li>将缓存起来的字节在一个数据段中发出，再继续缓存，直到发出的数据得到确认</li>
</ul>
<p>Nagle算法在很多TCP上实现，但是有些时候最好禁用，比如：当一个X-Windows应用在互联网运行的时候，鼠标的移动事件必须发送给远程计算机，把这些移动事件收集起来一批一批发送出去，使得鼠标的移动极不连贯</p>
<h3 id="傻瓜窗口综合症"><a href="#傻瓜窗口综合症" class="headerlink" title="傻瓜窗口综合症"></a>傻瓜窗口综合症</h3><p>另一个使TCP性能退化的问题是傻瓜窗口综合症（silly window syndrome problem）：当有大块数据被传递给发送端TCP实体，但接收端的交互式应用每次只读取一个字节的时候，就会出现问题：</p>
<p>发送方每向接收方发送一个连接数据段，就会占满整个接收方的空间，然后接收方就会返回一个剩余大小为0的确认，导致发送方等待一段时间，直到新的确认返回后继续发送消息，但只要一发送数据段就会占满，导致数据无法从输入端传递到输出端。</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p><strong>Clark解决方案</strong> ：阻止接收方发送只有1个字节的窗口更新，<br>相反，它必须等待一段时间，当有了一定数量的空间之后再<br>告诉发送方，接收方可以可以维护一个内部缓冲，且阻塞上层应用的READ 请求，直到它有大块的数据提供</p>
<h3 id="总述："><a href="#总述：" class="headerlink" title="总述："></a>总述：</h3><ul>
<li>发送方<ul>
<li>尽量不发送数据含量小的数据段</li>
<li>缓存应用层的数据，达到一定量再发送</li>
</ul>
</li>
<li>接收方<ul>
<li>不请求对方发送短数据段(window size)</li>
<li>延迟窗口变更信息，使接收缓冲区足够大</li>
</ul>
</li>
</ul>
<hr>
<h2 id="TCP拥塞控制"><a href="#TCP拥塞控制" class="headerlink" title="TCP拥塞控制"></a>TCP拥塞控制</h2><p>虽然网络层也试图管理拥塞，但是，大多数繁重的任务是由<br>TCP来完成的，因为针对拥塞的真正解决方案是<strong>减慢数据率</strong>，所以TCP遵循<strong>分组守恒</strong>即当有一个老的分组离开之后才允许新的分组注入网络。 TCP希望通过动态维护窗口大小来实现这个目标</p>
<h3 id="TCP拥塞检测（Congestion-detection）"><a href="#TCP拥塞检测（Congestion-detection）" class="headerlink" title="TCP拥塞检测（Congestion detection）"></a>TCP拥塞检测（Congestion detection）</h3><p>所有的互联网TCP算法都假定<strong>超时是由拥塞引起</strong>的，并且通过<strong>监视超时</strong>的情况来判断是否出现问题</p>
<h4 id="拥塞控制-（Congestion-prevention）"><a href="#拥塞控制-（Congestion-prevention）" class="headerlink" title="拥塞控制 （Congestion prevention）"></a>拥塞控制 （Congestion prevention）</h4><ul>
<li>当一个连接建立的时候，双方选择一个合适的<strong>窗口大小</strong>，接收方根据自己的<strong>缓冲区大小</strong>来指定窗口的大小。</li>
<li>如果发送者遵守此窗口大小的限制，则接收端不会出现缓冲区溢出的问题，但可能由于<strong>网络内部的拥塞</strong>而发生问题（网络内部的瓶颈）</li>
</ul>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6.jpg" alt="TCP拥塞控制"></p>
<p>如图中（a）快速的网络向小容量的接收方传输数据（接收者容量问题），（b）慢速的网络向大容量的接受方传输数据（网络容量问题）</p>
<p>互联网解决方案应该是认识到两个潜在的问题的：网络容量，接收者容量，然后单独地处理这两个问题</p>
<p>为此，每个发送者维护两个窗口：</p>
<ul>
<li><strong>接收者窗口</strong> 大小反映了目前窗口的容量 （<strong>容易控制</strong>）</li>
<li><strong>拥塞窗口</strong> 大小反映了网络目前的容量（<strong>难于控制</strong>）</li>
</ul>
<p>为此要保证发送者发送的数据字节数是两个窗口中小的那个窗口数，这样就既不会因为接收者窗口大小导致拥塞，也不会因为网络容量大小导致拥塞</p>
<h3 id="慢启动算法Slow-Start"><a href="#慢启动算法Slow-Start" class="headerlink" title="慢启动算法Slow Start"></a>慢启动算法Slow Start</h3><p>（决定拥塞窗口的大小）</p>
<ul>
<li>当连接建立的时候，发送者用当前使用的最大数据段长度初始化拥塞窗口，然后发送一个最大的数据段</li>
<li>如果在定时器超期之前收到确认，则将拥塞窗口翻倍，然后发送两个数据段……直至超时（或达到接收方窗口的大小）</li>
<li>确定出拥塞窗口的大小<ul>
<li>如：如果试图发送 4096字节没有问题，但是发送8192字节的时候，超时没有收到应答，则拥塞窗口设为4096个字节</li>
</ul>
</li>
</ul>
<p>因此在达到接收窗口大小或超时前，慢启动算法下的拥塞窗口大小都是以指数形式增长的</p>
<p><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/%E6%85%A2%E5%90%AF%E5%8A%A8%E7%AE%97%E6%B3%95.jpg" alt="慢启动算法"></p>
<h3 id="阈值"><a href="#阈值" class="headerlink" title="阈值"></a>阈值</h3><p>除了使用接收者窗口和拥塞窗口，TCP拥塞控制还是用了第三<br>个参数，阈值（threshold），初始化为64K</p>
<p>当一个超时发生的时候，阈值降为当前拥塞窗口的一半，同<br>时将拥塞窗口设为一个最大数据段的长度</p>
<p>使用慢启动算法来决定网络的容量，拥塞窗口增长到阈值时<br>停止指数增长</p>
<p>从这个点开始，每次成功的传输都会让拥塞窗口线性增长<br>（即每次仅增长一个最大的数据段长度）</p>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><ul>
<li>线性增长，可以将越来越粗放的窗口尝试力度变小，以获得更准确的拥塞窗口值</li>
<li>TCP慢启动算法就是这样不断超时，不断重启，尝试出的拥塞控制窗口值也随着网络状况的变化而变化，达到拥塞控制的目的</li>
<li>重新慢启动的时候，拥塞窗口值不用重置为一个数据段大小，而是可以设置为阈值大小，从这里直接开始线性增长，这就是所谓的快速恢复</li>
<li>如果收到一个ICMP抑制分组（ ICMP source quench）并被送给TCP传输实体 ，则这个事件被当作超时对待</li>
</ul>
<hr>
<h2 id="TCP定时器"><a href="#TCP定时器" class="headerlink" title="TCP定时器"></a>TCP定时器</h2><h3 id="重传定时器"><a href="#重传定时器" class="headerlink" title="重传定时器"></a>重传定时器</h3><p>TCP采用了肯定确认重传技术来保证每一个字节的可靠传输，为解决数据段丢失问题，每发一个数据段都会启动一个<strong>重传定时器</strong>，它是最重要的定时器之一</p>
<p>它的时间设置需要非常多的考量，如果时间设置过长，就会导致等待时间过长，如果设置过短，可能引发频繁的超时和重传</p>
<h3 id="持续定时器"><a href="#持续定时器" class="headerlink" title="持续定时器"></a>持续定时器</h3><p>用来避免如下的死锁（ deadlock ）发生</p>
<h4 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h4><ul>
<li>接收方发送了一个窗口数为零的确认（窗口更新），告诉发送方等待。</li>
<li>稍后，接收方空出了缓冲，发送更新窗口的数据段，但是，很不幸，该分组中途丢失</li>
<li>现在，收发双方都在等待对方发送数据段过来，但永远等不到，死锁产生。</li>
</ul>
<h4 id="利用持续定时器解决死锁问题"><a href="#利用持续定时器解决死锁问题" class="headerlink" title="利用持续定时器解决死锁问题"></a>利用持续定时器解决死锁问题</h4><p>当接收方发送一个窗口数为0的确认后，发送方开始启动一个持续定时器</p>
<p>此时，如果接收方在计时器限定时间范围内空出空间，并成功发送新确认到发送方，持续计时器结束并继续数据传输</p>
<p>假设持续计时器时间为0新的确认还没有到达，此时发送方就会发送一个探测数据段，里边没有任何数据内容，单纯引发接收方重新发送一个确认，以解决死锁问题</p>
<h3 id="保活定时器"><a href="#保活定时器" class="headerlink" title="保活定时器"></a>保活定时器</h3><p>用来检查连接是否存活，当一个连接空闲的时间超过保活定时器的时间，该连接将被杀掉。</p>
<p>还有在关闭时刻处于TIMED WAIT状态中使用的定时器：运行两倍的最大分组生存时间，以确保连接关闭之后，该连接上的所有分组都完全消失。</p>
<hr>
<table>
<thead>
<tr>
<th>性能</th>
<th>TCP</th>
<th>UDP</th>
</tr>
</thead>
<tbody><tr>
<td>可靠性</td>
<td>T</td>
<td>F</td>
</tr>
<tr>
<td>传输延迟</td>
<td>不确定</td>
<td>网络延迟</td>
</tr>
<tr>
<td>拥塞控制</td>
<td>T</td>
<td>F</td>
</tr>
</tbody></table>
<h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><ul>
<li>可靠传输方式</li>
<li>可让应用程序简单化，程序员可以不必进行错误检查、修正等工作</li>
</ul>
<h4 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h4><ul>
<li>为了降低对计算机资源的需求（DNS）</li>
<li>应用程序本身已提供数据完整性的检查机制，勿须依赖传输层的协议来保证</li>
<li>应用程序传输的并非关键性的数据（路由器周期性的路由信息交换）</li>
<li>一对多方式，必须使用UDP（TCP限于一对一的传送）（视频传播）</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ywrby</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://ywrby.cn/2021/03/25/3-%E4%BC%A0%E8%BE%93%E5%B1%82/">http://ywrby.cn/2021/03/25/3-%E4%BC%A0%E8%BE%93%E5%B1%82/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></div><div class="post_share"><div class="social-share" data-image="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/27/1-MySQL%E7%AE%80%E8%BF%B0/"><img class="prev-cover" src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/72581222_p0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">1-MySQL简述</div></div></a></div><div class="next-post pull-right"><a href="/2021/03/21/19-MyBatis%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/"><img class="next-cover" src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">19-MyBatis注解开发</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/03/07/1-计算机网络和因特网/" title="1-计算机网络和因特网"><img class="cover" src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/67888138_p0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-07</div><div class="title">1-计算机网络和因特网</div></div></a></div><div><a href="/2021/03/12/2-应用层/" title="2-应用层"><img class="cover" src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/77593329_p0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-12</div><div class="title">2-应用层</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/ywrby.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Ywrby</div><div class="author-info__description">Students majoring in CS at SWU</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">70</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ywrby"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:ywrby0214@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/353923033" target="_blank" title="Bilibili"><i class="fas fa-file-video"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2491757717&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://twitter.com/ywrby1" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a><a class="social-icon" href="https://www.facebook.com/profile.php?id=100033741068822" target="_blank" title="Facebook"><i class="fab fa-facebook"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">Less is more</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">传输层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">传输层概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%AE%9E%E4%BD%93"><span class="toc-number">1.1.1.</span> <span class="toc-text">传输实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%B1%82%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.1.2.</span> <span class="toc-text">传输层与网络层的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%AE%B5TPDU"><span class="toc-number">1.1.3.</span> <span class="toc-text">数据段TPDU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.4.</span> <span class="toc-text">常用协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8E%E8%A7%A3%E5%A4%8D%E7%94%A8"><span class="toc-number">1.1.5.</span> <span class="toc-text">多路复用与解复用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">多路复用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%B7%AF%E8%A7%A3%E5%A4%8D%E7%94%A8"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">多路解复用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E8%BF%9E%E6%8E%A5%EF%BC%88UDP%EF%BC%89%E5%A4%9A%E8%B7%AF%E8%A7%A3%E5%A4%8D%E7%94%A8"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">无连接（UDP）多路解复用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E8%BF%9E%E6%8E%A5%EF%BC%88TCP%EF%BC%89%E7%9A%84%E5%A4%9A%E8%B7%AF%E8%A7%A3%E5%A4%8D%E7%94%A8"><span class="toc-number">1.1.5.4.</span> <span class="toc-text">面向连接（TCP）的多路解复用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE-UDP"><span class="toc-number">1.2.</span> <span class="toc-text">用户数据报协议 UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP%E6%95%B0%E6%8D%AE%E6%AE%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">UDP数据段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%AE%B5%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">数据段头结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">端口定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E6%A0%A1%E9%AA%8C%E5%92%8C"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">UDP校验和</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP-UDP%E4%BC%AA%E5%A4%B4%E9%83%A8%EF%BC%88pseudo-header%EF%BC%89"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">TCP&#x2F;UDP伪头部（pseudo header）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">通信模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E7%82%B9"><span class="toc-number">1.3.1.</span> <span class="toc-text">端点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B-%E9%80%9A%E4%BF%A1%E4%BA%94%E5%85%83%E7%BB%84"><span class="toc-number">1.3.2.</span> <span class="toc-text">通信模型-通信五元组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B7%B2%E5%88%86%E9%85%8D%E7%9A%84%E7%9F%A5%E5%90%8D%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.3.3.</span> <span class="toc-text">一些已分配的知名端口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E6%95%B0%E6%8D%AE%E6%AE%B5"><span class="toc-number">1.4.</span> <span class="toc-text">TCP数据段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.1.</span> <span class="toc-text">TCP-传输控制协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E6%96%B9%EF%BC%9A%E5%B0%81%E8%A3%85"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">发方：封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B6%E6%96%B9%EF%BC%9A%E8%A7%A3%E5%B0%81%E8%A3%85"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">收方：解封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E8%BD%AF%E4%BB%B6%E5%86%B3%E5%AE%9A%E6%95%B0%E6%8D%AE%E6%AE%B5%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%8C%E6%9C%89%E4%B8%A4%E4%B8%AA%E5%9B%A0%E7%B4%A0%E9%99%90%E5%88%B6%E4%BA%86%E6%95%B0%E6%8D%AE%E6%AE%B5%E7%9A%84%E9%95%BF%E5%BA%A6%EF%BC%9A"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">TCP软件决定数据段的大小，有两个因素限制了数据段的长度：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TPDU-TCP%E6%95%B0%E6%8D%AE%E6%AE%B5"><span class="toc-number">1.4.2.</span> <span class="toc-text">TPDU TCP数据段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%AB%AF%E5%8F%A3%E5%92%8C%E7%9B%AE%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%AD%97%E6%AE%B5"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">源端口和目的端口字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8F%B7-%E2%80%93-%E5%AD%97%E8%8A%82%E5%8F%B7-32-%E4%BD%8D"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">序列号 – 字节号 (32 位)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E5%8F%B7"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">确认号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E6%AE%B5%E5%A4%B4%E9%95%BF%E5%BA%A6"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">TCP段头长度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E7%95%99%E5%9F%9F-%E5%AD%97%E6%AE%B5"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">保留域&#x2F;字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%AF%94%E7%89%B9"><span class="toc-number">1.4.2.6.</span> <span class="toc-text">控制比特</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%B0%BA%E5%AF%B8"><span class="toc-number">1.4.2.7.</span> <span class="toc-text">窗口尺寸</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E5%92%8C"><span class="toc-number">1.4.2.8.</span> <span class="toc-text">校验和</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A7%E6%80%A5%E6%8C%87%E9%92%88"><span class="toc-number">1.4.2.9.</span> <span class="toc-text">紧急指针</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9%E5%9F%9F-%E5%8F%AF%E9%80%89"><span class="toc-number">1.4.2.10.</span> <span class="toc-text">选项域(可选)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.</span> <span class="toc-text">TCP三次握手建立连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">TCP连接的建立</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DoS%E6%94%BB%E5%87%BB"><span class="toc-number">1.5.2.</span> <span class="toc-text">DoS攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E8%BF%9E%E6%8E%A5%E9%87%8A%E6%94%BE"><span class="toc-number">1.6.</span> <span class="toc-text">TCP连接释放</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E6%AD%A3%E5%B8%B8%E9%87%8A%E6%94%BE%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.6.1.</span> <span class="toc-text">三次握手正常释放连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E7%BB%88%E6%AD%A2%E4%BC%9A%E8%AF%9D"><span class="toc-number">1.6.2.</span> <span class="toc-text">TCP四次挥手终止会话</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E7%9A%84%E7%A1%AE%E8%AE%A4TPDU%E4%B8%A2%E5%A4%B1"><span class="toc-number">1.6.3.</span> <span class="toc-text">最后的确认TPDU丢失</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E4%BC%A0%E8%BE%93%E7%AD%96%E7%95%A5"><span class="toc-number">1.7.</span> <span class="toc-text">TCP传输策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%8E%A5%E6%94%B6%E7%AB%AF"><span class="toc-number">1.7.1.</span> <span class="toc-text">优化接收端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%8F%91%E9%80%81%E7%AB%AF"><span class="toc-number">1.7.2.</span> <span class="toc-text">优化发送端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nagle%E7%AE%97%E6%B3%95"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">Nagle算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%82%BB%E7%93%9C%E7%AA%97%E5%8F%A3%E7%BB%BC%E5%90%88%E7%97%87"><span class="toc-number">1.7.3.</span> <span class="toc-text">傻瓜窗口综合症</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">解决方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E8%BF%B0%EF%BC%9A"><span class="toc-number">1.7.4.</span> <span class="toc-text">总述：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">1.8.</span> <span class="toc-text">TCP拥塞控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E6%8B%A5%E5%A1%9E%E6%A3%80%E6%B5%8B%EF%BC%88Congestion-detection%EF%BC%89"><span class="toc-number">1.8.1.</span> <span class="toc-text">TCP拥塞检测（Congestion detection）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6-%EF%BC%88Congestion-prevention%EF%BC%89"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">拥塞控制 （Congestion prevention）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E5%90%AF%E5%8A%A8%E7%AE%97%E6%B3%95Slow-Start"><span class="toc-number">1.8.2.</span> <span class="toc-text">慢启动算法Slow Start</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%88%E5%80%BC"><span class="toc-number">1.8.3.</span> <span class="toc-text">阈值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">注意：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.9.</span> <span class="toc-text">TCP定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E4%BC%A0%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.9.1.</span> <span class="toc-text">重传定时器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.9.2.</span> <span class="toc-text">持续定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">死锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%8C%81%E7%BB%AD%E5%AE%9A%E6%97%B6%E5%99%A8%E8%A7%A3%E5%86%B3%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">利用持续定时器解决死锁问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E6%B4%BB%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.9.3.</span> <span class="toc-text">保活定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">TCP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">UDP</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/03/27/1-MySQL%E7%AE%80%E8%BF%B0/" title="1-MySQL简述"><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/72581222_p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1-MySQL简述"/></a><div class="content"><a class="title" href="/2021/03/27/1-MySQL%E7%AE%80%E8%BF%B0/" title="1-MySQL简述">1-MySQL简述</a><time datetime="2021-03-27T13:04:29.000Z" title="Created 2021-03-27 21:04:29">2021-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/25/3-%E4%BC%A0%E8%BE%93%E5%B1%82/" title="3-传输层"><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3-传输层"/></a><div class="content"><a class="title" href="/2021/03/25/3-%E4%BC%A0%E8%BE%93%E5%B1%82/" title="3-传输层">3-传输层</a><time datetime="2021-03-25T09:18:41.000Z" title="Created 2021-03-25 17:18:41">2021-03-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/21/19-MyBatis%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/" title="19-MyBatis注解开发"><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="19-MyBatis注解开发"/></a><div class="content"><a class="title" href="/2021/03/21/19-MyBatis%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/" title="19-MyBatis注解开发">19-MyBatis注解开发</a><time datetime="2021-03-21T08:43:50.000Z" title="Created 2021-03-21 16:43:50">2021-03-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/21/18-MyBatis%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C/" title="18-MyBatis多表操作"><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/73870940_p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="18-MyBatis多表操作"/></a><div class="content"><a class="title" href="/2021/03/21/18-MyBatis%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C/" title="18-MyBatis多表操作">18-MyBatis多表操作</a><time datetime="2021-03-21T03:52:14.000Z" title="Created 2021-03-21 11:52:14">2021-03-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/20/17-MyBatis%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E4%B8%8E%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B7%B1%E5%85%A5/" title="17-MyBatis映射文件与核心配置文件深入"><img src="https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/83821828_p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="17-MyBatis映射文件与核心配置文件深入"/></a><div class="content"><a class="title" href="/2021/03/20/17-MyBatis%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E4%B8%8E%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B7%B1%E5%85%A5/" title="17-MyBatis映射文件与核心配置文件深入">17-MyBatis映射文件与核心配置文件深入</a><time datetime="2021-03-20T05:53:36.000Z" title="Created 2021-03-20 13:53:36">2021-03-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://ywrbyimg.oss-cn-chengdu.aliyuncs.com/img/80857290_p0.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Ywrby</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', '', 'katex-wrap')
  })
})()</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'QkExI1n70lz2qs7pVpmFeKqp-gzGzoHsz',
      appKey: 'WhG61iDj96bflhu6CIpmE9V8',
      placeholder: 'Please leave your footprints',
      avatar: 'mp',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="5402995011" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-lrctype=0	data-order="random" data-preload="none" data-autoplay="true" muted></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>